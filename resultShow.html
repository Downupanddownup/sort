<!DOCTYPE HTML>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Highcharts Example</title>

    <style type="text/css">
        #container {
            max-width: 800px;
            height: 400px;
            margin: 1em auto;
        }

    </style>
</head>

<script src="http://code.jquery.com/jquery-1.7.2.min.js"></script>

<script type="text/javascript">
    function getArray() {
        let n = 100;
        let data = new Array(n);
        alert(data[99]);
        for (let i = 0; i < n; i++) {
            var idx = 0;
            do{
                idx = Math.floor(Math.random()*n);
            }while (data[idx] != undefined)
            data[idx] = i;
        }
        return data;
    }
    function refresh() {
        var data = [3.5, 3, 3.2, 3.1, 3.6, 3.9, 3.4, 3.4, 2.9, 3.1, 3.7, 3.4, 3, 3, 4, 4.4, 3.9, 3.5, 3.8, 3.8, 3.4, 3.7, 3.6, 3.3, 3.4, 3, 3.4, 3.5, 3.4, 3.2, 3.1, 3.4, 4.1, 4.2, 3.1, 3.2, 3.5, 3.6, 3, 3.4, 3.5, 2.3, 3.2, 3.5, 3.8, 3, 3.8, 3.2, 3.7, 3.3, 3.2, 3.2, 3.1, 2.3, 2.8, 2.8, 3.3, 2.4, 2.9, 2.7, 2, 3, 2.2, 2.9, 2.9, 3.1, 3, 2.7, 2.2, 2.5, 3.2, 2.8, 2.5, 2.8, 2.9, 3, 2.8, 3, 2.9, 2.6, 2.4, 2.4, 2.7, 2.7, 3, 3.4, 3.1, 2.3, 3, 2.5, 2.6, 3, 2.6, 2.3, 2.7, 3, 2.9, 2.9, 2.5, 2.8, 3.3, 2.7, 3, 2.9, 3, 3, 2.5, 2.9, 2.5, 3.6, 3.2, 2.7, 3, 2.5, 2.8, 3.2, 3, 3.8, 2.6, 2.2, 3.2, 2.8, 2.8, 2.7, 3.3, 3.2, 2.8, 3, 2.8, 3, 2.8, 3.8, 2.8, 2.8, 2.6, 3, 3.4, 3.1, 3, 3.1, 3.1, 3.1, 2.7, 3.2, 3.3, 3, 2.5, 3, 3.4, 3];

        data = getArray();

        Highcharts.chart('container', {
            title: {
                text: 'Highcharts Histogram'
            },
            xAxis: [{
                title: { text: 'Data' },
                alignTicks: false
            }, {
                title: { text: 'Histogram' },
                alignTicks: false,
                opposite: true
            }],

            yAxis: [{
                title: { text: 'Data' }
            }, {
                title: { text: 'Histogram' },
                opposite: true
            }],

            series: [{
                name: 'Histogram',
                type: 'histogram',
                xAxis: 1,
                yAxis: 1,
                baseSeries: 's1',
                zIndex: -1
            }, {
                name: 'Data',
                type: 'scatter',
                data: data,
                id: 's1',
                marker: {
                    radius: 1.5
                }
            }]
        });
    }

    function getData() {
        let oldData = [
            ['上海', 24.25],
            ['卡拉奇', 23.50],
            ['北京', 21.51],
            ['德里', 16.78],
            ['拉各斯', 16.06],
            ['天津', 15.20],
            ['伊斯坦布尔', 14.16],
            ['东京', 13.51],
            ['广州', 13.08],
            ['孟买', 12.44],
            ['莫斯科', 12.19],
            ['圣保罗', 12.03],
            ['深圳', 10.46],
            ['雅加达', 10.07],
            ['拉合尔', 10.05],
            ['首尔', 9.99],
            ['武汉', 9.78],
            ['金沙萨', 9.73],
            ['开罗', 9.27],
            ['墨西哥', 8.87]
        ];
        let n = oldData.length;
        let data = new Array(n);
        for (let i = 0; i < n; i++) {
            var idx = 0;
            do{
                idx = Math.floor(Math.random()*n);
            }while (data[idx] != undefined)
            data[idx] = oldData[i];
        }
        return data;
    }

    function refreshAllTheTime() {
        refresh2();
    }

    function refresh2() {
        let data = getData();
        var chart = Highcharts.chart('container', {
            chart: {
                type: 'column'
            },
            title: {
                text: '全球各大城市人口排行'
            },
            subtitle: {
                text: '数据截止 2017-03，来源: <a href="https://en.wikipedia.org/wiki/List_of_cities_proper_by_population">Wikipedia</a>'
            },
            xAxis: {
                type: 'category',
                labels: {
                    rotation: -45  // 设置轴标签旋转角度
                }
            },
            yAxis: {
                min: 0,
                title: {
                    text: '人口 (百万)'
                }
            },
            legend: {
                enabled: false
            },
            tooltip: {
                pointFormat: '人口总量: <b>{point.y:.1f} 百万</b>'
            },
            series: [{
                name: '总人口',
                data: data,
                dataLabels: {
                    enabled: true,
                    rotation: -90,
                    color: '#FFFFFF',
                    align: 'right',
                    format: '{point.y:.1f}', // :.1f 为保留 1 位小数
                    y: 10
                }
            }]
        });
        // setTimeout(refresh2, 2000 );
    }


    let sortData = [
        ['0',6],
        ['1',5],
        ['2',4],
        ['3',3],
        ['4',2],
        ['5',1]
    ]

    let n = 0;
    function bubbleSort(location,isMoved) {
        n++;
        console.log("num",n);
        if(location < sortData.length-1){
            if(sortData[location][1] > sortData[location+1][1]){
                let temp = sortData[location+1];
                sortData[location+1] = sortData[location];
                sortData[location] = temp;
            }
            showSortResult(sortData,location+1,true);
        }else {
            if(isMoved){
                showSortResult(sortData,0,false);
            }
        }
    }

    function showSortResult(data,location,isMoved) {
        var chart = Highcharts.chart('container', {
            chart: {
                type: 'column'
            },
            title: {
                text: '全球各大城市人口排行'
            },
            subtitle: {
                text: '数据截止 2017-03，来源: <a href="https://en.wikipedia.org/wiki/List_of_cities_proper_by_population">Wikipedia</a>'
            },
            xAxis: {
                type: 'category',
                labels: {
                    rotation: -45  // 设置轴标签旋转角度
                }
            },
            yAxis: {
                min: 0,
                title: {
                    text: '人口 (百万)'
                }
            },
            legend: {
                enabled: false
            },
            tooltip: {
                pointFormat: '人口总量: <b>{point.y:.1f} 百万</b>'
            },
            series: [{
                name: '总人口',
                data: data,
                dataLabels: {
                    enabled: true,
                    rotation: -90,
                    color: '#FFFFFF',
                    align: 'right',
                    format: '{point.y:.1f}', // :.1f 为保留 1 位小数
                    y: 10
                },
                animation: false
            }]
        });
        setTimeout(bubbleSort, 1500,location,isMoved);
    }

    function sort() {
        showSortResult(sortData,0,false);
    }

    let customData = [
        [0,7],
        [1,6],
        [2,5],
        [3,4],
        [4,3],
        [5,2],
        [6,1]
    ];
    let style = {
        allWidth : 800,
        allHeight : 300,
        width : 30,
        unitHeight : 50,
        space : 10
    }
    function createTable() {
        let lenth = (style.allWidth - (style.space + style.width)*customData.length)/2;

        let html = '<div style="position: relative;width: ' + style.allWidth +
            'px;height: ' + style.allHeight +
            'px;">';
        for (let i = 0; i < customData.length; i++) {
            html += '<div id="sort_'+ customData[i][0] +'" style="position:absolute;bottom:0px;' +
                'height: ' + customData[i][1]*style.unitHeight +
                'px;width: ' + style.width +
                'px;margin-left: ' + (style.space+lenth) +
                'px;background-color: aqua;float: left;"></div>';
            lenth += style.width + style.space;
        }
        html += '</div>';
        $('#container').html(html);
        console.log(customData);
    }

    function addClassC() {
        modify('sort_0',-100);
    }

    function modify(id,width) {
        let transform = $('#'+id).css('transform');
        let deviation = 0;
        if(transform && transform != 'none'){
            deviation = transform.split(',')[4];
        }
        let withoff = parseInt(deviation)+width;
        $('#'+id).css({
            'transform' : 'translate('+ withoff +'px,0px)',
            'transition' : 'transform 0.35s'
        })
    }

    function customSort(l,isMoved) {
        if(l < customData.length-1){
            if(customData[l][1] > customData[l+1][1]){
                modify("sort_"+customData[l][0],style.width+style.space);
                modify("sort_"+customData[l+1][0],(style.width+style.space)*-1);
                let temp = customData[l+1];
                customData[l+1] = customData[l];
                customData[l] = temp;
                setTimeout(customSort,350,l+1,true);
                console.log(customData);
            }else {
                customSort(l+1,isMoved);
            }
        }else {
            if(isMoved){
                customSort(0,false);
            }else {
                console.log('gameOver');
            }

        }
    }
    
</script>

<style>

    .selectedLeft{

    }
    .selectedRight{

    }
    .moveToLeft{
        transform: translate(400px,0px);
        transition: transform 0.35s;
    }
    .moveToRight{

    }

</style>

<body>
<script src="code/highcharts.js"></script>
<script src="code/modules/histogram-bellcurve.js"></script>
<div id="container" ></div>

<button onclick="refreshAllTheTime()" value="" style="width: 100px;height: 100px">刷新</button>

<button onclick="sort()" value="" style="width: 100px;height: 100px">排序</button>

<button onclick="createTable()" value="" style="width: 100px;height: 100px">自定义</button>

<button onclick="customSort(0,false)" value="" style="width: 100px;height: 100px">添加类</button>
</body>
</html>
